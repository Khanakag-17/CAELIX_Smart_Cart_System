<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailFlow - Smart Checkout System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body>
    <!--Main Header -->
    <header class="header" id = 'main-header'>

        <button id="sidebar-toggle-btn" class="sidebar-toggle-btn">
            <!-- Use a menu icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                <path d="M40,128a8,8,0,0,1,8-8H208a8,8,0,0,1,0,16H48A8,8,0,0,1,40,128Zm0-40a8,8,0,0,1,8-8H208a8,8,0,0,1,0,16H48A8,8,0,0,1,40,88Zm8,72H208a8,8,0,0,1,0,16H48a8,8,0,0,1,0-16Z"/>
            </svg>
        </button>

        <div class="logo-container">
            <img src="../logos\complete_logo.png" alt="logos\dashboard_logo.png" style="width: 3.5em; height: 2.5em;">
        </div>

          <!-- Navigation Links -->
        <nav class="header-nav" id = 'navbar'>
            <a href="#stats">Stats</a>
            <a href="#inventory">Inventory</a>
            <a href="#alerts">Alerts</a>
            <a href="#sales">Sales</a>
        </nav>

        <div class="header-actions">
            <div class="user-avatar">AD</div>
        </div>
        
    </header>

    <!-- Live cart Header -->

    <header class="header" id = 'live-cart-header' style="display: none;">

        <button id="sidebar-toggle-btn-cart" class="sidebar-toggle-btn">
            <!-- Use a menu icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                <path d="M40,128a8,8,0,0,1,8-8H208a8,8,0,0,1,0,16H48A8,8,0,0,1,40,128Zm0-40a8,8,0,0,1,8-8H208a8,8,0,0,1,0,16H48A8,8,0,0,1,40,88Zm8,72H208a8,8,0,0,1,0,16H48a8,8,0,0,1,0-16Z"/>
            </svg>
        </button>

        <div class="logo-container">
            <img src="../logos\complete_logo.png" alt="logos\dashboard_logo.png" style="width: 3.5em; height: 2.5em;">
        </div>


        <div class="header-actions">
            <div class="user-avatar">AD</div>
        </div>
        
    </header>
    
    <div class="dashboard-container">

        <!-- Expandable Sidebar -->
        <aside id="expandable-sidebar">
            <div class="sidebar-header">
                <h2>Quick Menu</h2>
            </div>
            <ul class="sidebar-links">
                <li><a href="#" id="dashboard-link">
                    <span>
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM40,56H216V96H40ZM216,200H112V112H216v88Z"></path>
                        </svg>
                    </span> Dashboard</a></li>
                <li><a href="#" id="monitoring-link">
                    <span>
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M224,64H208V56a16,16,0,0,0-16-16H64A16,16,0,0,0,48,56v8H32A16,16,0,0,0,16,80V200a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V80A16,16,0,0,0,224,64Zm-48,0H80V56H176ZM224,200H32V80H224V200ZM160,128a32,32,0,1,1-32-32A32,32,0,0,1,160,128Zm-16,0a16,16,0,1,0-16,16A16,16,0,0,0,144,128Z"/>
                        </svg>
                    </span> Cart Monitor</a></li>
                <li><a href="#" id="location-link">
                    <span>
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M128,16A80,80,0,0,0,48,96c0,66.55,72.18,135.22,75.22,138a8,8,0,0,0,10.56,0C135.82,231.22,208,162.55,208,96A80,80,0,0,0,128,16Zm0,104a24,24,0,1,1,24-24A24,24,0,0,1,128,120Z"/>
                        </svg>
                    </span> Cart Tracker</a></li>
                <li><a href="#" id="inventory-link">
                    <span>
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M224,56H32A16,16,0,0,0,16,72V184a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V72A16,16,0,0,0,224,56Zm0,128H32V72H224v112ZM64,104a8,8,0,0,1,8-8H184a8,8,0,0,1,0,16H72A8,8,0,0,1,64,104Zm0,32a8,8,0,0,1,8-8H184a8,8,0,0,1,0,16H72A8,8,0,0,1,64,136Z"/>
                        </svg>
                    </span> Inventory</a></li>
            </ul>

            <div class="sidebar-footer">
                <a href="#" class="logout-btn" style="position:absolute; width:50%; bottom: 2rem; font-weight:500">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="20" height="20" viewBox="0 0 256 256">
                    <path d="M224,128a8,8,0,0,1-8,8H75.31l37.35,37.34a8,8,0,1,1-11.32,11.32l-52-52a8,8,0,0,1,0-11.32l52-52a8,8,0,1,1,11.32,11.32L75.31,120H216A8,8,0,0,1,224,128Z"/>
                    </svg>
                    <span>Logout</span>
                </a>
            </div>

        </aside>

        
        <!-- Main Content -->
        <main class="main-content" id="dashboard-section">
            <div class="section-header">
                <h1 class="section-title">Dashboard</h1>
                <div id="current-date" class="text-secondary"></div>
            </div>
            
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Inactive Sessions</div>
                    <div class="stat-value pulse" id="inactive-sessions">2</div>
                    <div class="stat-trend trend-up-negative">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 2.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8 3.207 5.354 5.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                        <span>2 carts inactive</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Active Carts</div>
                    <div class="stat-value pulse" id="active-carts">0</div>
                    <div class="stat-trend trend-down">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 12.5a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-1 0v9a.5.5 0 0 0 .5.5z"/>
                            <path d="M7.646 13.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8 12.793l-2.646-2.647a.5.5 0 0 0-.708.708l3 3z"/>
                        </svg>
                        <span>Fetching...</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Theft Alerts</div>
                    <div class="stat-value pulse" id="live-alerts">0</div>
                    <div class="stat-trend trend-up">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 2.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8 3.207 5.354 5.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                        <span >Fetching...</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-title">Camera Alerts</div>
                    <div class="stat-value pulse" id="camera-alerts">3</div>
                    <div class="stat-trend trend-up-negative">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 2.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8 3.207 5.354 5.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                        <span>3 carts unresponsive</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-title">Cart Monitor Alerts</div>
                    <div class="stat-value pulse" id="live-alerts">1</div>
                    <div class="stat-trend trend-up-negative">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 2.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8 3.207 5.354 5.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                        <span>1 cart out of premises</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Today's Sales</div>
                    <div class="stat-value">â‚¹ 14,500</div>
                    <div class="stat-trend trend-up">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 2.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8 3.207 5.354 5.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                        <span>10% from yesterday</span>
                    </div>
                </div>
            </div>

            
                        
            <!-- Inventory Section -->
            <div class="table-container">
                <div class="table-header">Low Inventory Items</div>
                <div id="low-inventory-bar" class="table-row">
                    <!-- JS will inject items here -->
                </div>
                <div class="low-inventory-footer">
                    <button id="view-full-inventory-btn" class="view-inventory-btn">View Complete Inventory</button>
                </div>
            </div>

            
            <!-- Theft Alert Feed -->
            <div class="table-container" id="theft-alert-feed">
                <div class="table-header">Theft Alert Feed</div>
                <div class="table-content">
                    <!-- This header row stays -->
                    <div class="table-row">
                        <div class="table-cell"><strong>Cart ID</strong></div>
                        <div class="table-cell"><strong>Time</strong></div>
                        <div class="table-cell"><strong>Alert Status</strong></div>
                    </div>

                    <!-- JavaScript will insert alert rows here dynamically -->

                </div>
            </div>

            <!-- Cart Monitor Feed -->
            <div class="table-container" id="theft-alert-feed">
                <div class="table-header">Cart Alerts</div>
                <div class="table-content">
                    <!-- This header row stays -->
                    <div class="table-row">
                        <div class="table-cell"><strong>Cart ID</strong></div>
                        <div class="table-cell"><strong>Remark</strong></div>
                        <div class="table-cell"><strong>Access Location</strong></div>
                    </div>

                    <div class="table-row">
                        <div class="table-cell">CART002</div>
                        <div class="table-cell" style="color: red;">ðŸ”´ Outside Premises</div>
                        <div class="table-cell">
                            <button id="access-location-btn" class="view-inventory-btn">CART002 TRACKER</button>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Sales & Alerts Chart -->
            <div class="chart-container"  id = 'stats'>
                <div class="chart-header">
                    <div>
                        <h2 class="chart-title">Sales Overview</h2>
                        <div class="chart-stats">
                            <div class="chart-value">â‚¹ 14,500</div>
                            <div class="chart-subtitle">
                                <span>Today</span>
                                <span class="chart-trend">+10% from yesterday</span>
                            </div>
                        </div>
                    </div>
                    <select id="time-period" class="alert-tag" style="background: #333; color: white; border: none; padding: 8px 16px; border-radius: 8px;">
                        <option>Today</option>
                        <option>This Week</option>
                        <option>This Month</option>
                    </select>
                </div>
                <div class="chart-wrapper">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
        </main>

        <!-- Live Cart Monitoring -->

        <section class="main-content" id="monitoring-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Live Cart Monitoring</h2>
            </div>

            <div class="monitoring-grid-container">
                <!-- Grid of Active Carts with Radio Buttons -->
                <div class="monitoring-grid" id="cart-grid">
                    <!-- JS will inject cart cards here -->
                </div>

                <!-- Live Video Preview -->
                <div class="monitoring-video-container">
                    <div id="video-wrapper" class="video-placeholder">
                        <p class="video-message">Select a cart to start live feed</p>
                    </div>
                </div>
            </div>

            <div class="back-btn-container">
                <button id="live-back-to-dashboard">Back to Dashboard</button>
            </div>
        </section>

        <!-- Full Inventory Section -->

        <section id="full-inventory" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Store Inventory</h2>
            </div>
            <div class="table-container" id="inventory-table-container">
            <div class="table-content" id="complete-inventory-table">
                <div class="table-row" style="text-decoration: underline;">
                <div class="table-cell"><strong>Product Name</strong></div>
                <div class="table-cell"><strong>Quantity</strong></div>
                <div class="table-cell"><strong>Price</strong></div>
                <div class="table-cell"><strong>Availability</strong></div>
                </div>

                <!-- JS will inject rows here -->
            </div>
            </div>
            <div class="back-btn-container">
                <button id="back-to-dashboard">Back to Dashboard</button>
            </div>
        </section>

        <!-- Cart Tracker Section -->
        <section class="main-content" id="cart-tracker" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Cart Tracker</h2>
            </div>

            <div class="monitoring-grid-container">

                <div class="monitoring-video-container">
                    <div id="map-cart2" class="video-placeholder" style="height: 400px; border-radius: 12px; display: none;"></div>

                    <div id="map-full" class="video-placeholder" style="height: 400px; border-radius: 12px; display: none;"></div>
                </div>
            <div class="back-btn-container">
                <button id="monitor-back-to-dashboard">Back to Dashboard</button>
            </div>
        </section>

    </div>


    <!-- Load Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Cart Monitor Loader -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Load our JavaScript -->
    <script src="script_new.js" type="module"></script>


    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
        import { getFirestore, collection, query, orderBy, limit, onSnapshot, where, getDocs }from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

        // Firebase config
        const firebaseConfig = {
            // Your Firebase configuration
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Logout with Firebase Auth
        const logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function (e) {
                e.preventDefault();

                // Check if Firebase is loaded
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    firebase.auth().signOut().then(() => {
                        window.location.href = '../landing_page.htm';
                    }).catch((error) => {
                        console.error('Logout failed:', error);
                        alert('Logout failed. Please try again.');
                    });
                } else {
                    // Fallback if Firebase not used
                    window.location.href = '../landing_page.htm';
                }
            });
        }

        //Live Alerts & Active Carts
        let lastActiveCartCount = 0;
        let lastAlertCount = 0;

        const updateStats = () => {
            const activeCartsRef = collection(db, "carts");
            const alertsRef = collection(db, "cart_logs");

            // ACTIVE CARTS
            onSnapshot(activeCartsRef, (snapshot) => {
                const activeCarts = snapshot.docs.filter(doc => doc.data().active === true).length;
                const diff = activeCarts - lastActiveCartCount;
                lastActiveCartCount = activeCarts;

                const activeEl = document.getElementById("active-carts");
                const trendEl = activeEl.parentElement.querySelector(".stat-trend");
                activeEl.textContent = activeCarts;

                if (diff > 0) {
                    trendEl.classList.remove("trend-down");
                    trendEl.classList.add("trend-up");
                    trendEl.innerHTML = `<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 2.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8 3.207 5.354 5.854a.5.5 0 1 1-.708-.708l3-3z"/>
                    </svg> <span>${diff} more than last check</span>`;
                } else {
                    trendEl.classList.remove("trend-up");
                    trendEl.classList.add("trend-down");
                    trendEl.innerHTML = `<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 12.5a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-1 0v9a.5.5 0 0 0 .5.5z"/>
                        <path d="M7.646 13.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8 12.793l-2.646-2.647a.5.5 0 0 0-.708.708l3 3z"/>
                    </svg> <span>${Math.abs(diff)} less than last check</span>`;
                }
            });

            // LIVE ALERTS
            onSnapshot(alertsRef, (snapshot) => {
                let alertCount = 0;

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const missing = data.missing_scanned_items || [];
                    const unscanned = data.unscanned_detected_items || [];

                    if (missing.length > 0 || unscanned.length > 0) {
                        alertCount++;
                    }
                });

                const alertEl = document.getElementById("live-alerts");
                const trendEl = alertEl.parentElement.querySelector(".stat-trend");
                const diff = alertCount - lastAlertCount;
                lastAlertCount = alertCount;

                alertEl.textContent = alertCount;

                trendEl.classList.remove("green", "red", "gray");

                if (diff > 0) {
                    trendEl.classList.remove("trend-down-negative");
                    trendEl.classList.add("trend-up-negative");
                    trendEl.innerHTML = `<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3.5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 2.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8 3.207 5.354 5.854a.5.5 0 1 1-.708-.708l3-3z"/>
                    </svg> <span>${diff} more than last check</span>`;
                } else {
                    trendEl.classList.remove("trend-up-negative");
                    trendEl.classList.add("trend-down-negative");
                    trendEl.innerHTML = `<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 12.5a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-1 0v9a.5.5 0 0 0 .5.5z"/>
                        <path d="M7.646 13.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8 12.793l-2.646-2.647a.5.5 0 0 0-.708.708l3 3z"/>
                    </svg> <span>${Math.abs(diff)} less than last check</span>`;
                }

            });

        };

        // Run it
        updateStats();


        // Theft Alert Feed Logic
        document.addEventListener('DOMContentLoaded', function () {
            const tableContent = document.querySelector('#theft-alert-feed');

            const clearOldRows = () => {
                const rows = tableContent.querySelectorAll('.table-row:not(:first-child)');
                rows.forEach(row => row.remove());
            };

            const formatTime = (timestamp) => {
                const date = new Date(timestamp); // âœ… handles string format
                return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            };

            const getRiskTag = (missing, unscanned) => {
                if (missing.length > 0 && unscanned.length > 0) return 'high-risk';
                if (unscanned.length > 0) return 'medium-risk';
                if (missing.length > 0) return 'low-risk';
                return null;
            };

            const getRiskLabel = (risk) => {
                return {
                    'high-risk': 'High Risk',
                    'medium-risk': 'Medium Risk',
                    'low-risk': 'Low Risk'
                }[risk] || 'No Risk';
            };

            const q = query(
                collection(db, "cart_logs"),
                orderBy("timestamp", "desc"),
                limit(10)
            );

            onSnapshot(q, (snapshot) => {
                clearOldRows();

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const cartId = data.cart_id || 'Unknown';
                    const time = formatTime(data.timestamp);
                    const missing = data.missing_scanned_items || [];
                    const unscanned = data.unscanned_detected_items || [];

                    const riskClass = getRiskTag(missing, unscanned);
                    if (!riskClass) return;

                    const row = document.createElement('div');
                    row.classList.add('table-row');

                    row.innerHTML = `
                        <div class="table-cell">${cartId}</div>
                        <div class="table-cell">${time}</div>
                        <div class="table-cell">
                            <span class="alert-tag ${riskClass}">${getRiskLabel(riskClass)}</span>
                        </div>
                    `;

                    tableContent.appendChild(row);
                });
            });

        // Live Cart Monitoring Firebase Logic
        const grid = document.getElementById('cart-grid');
        const videoWrapper = document.getElementById('video-wrapper'); // changed from img to div

        function showVideoMessage(msg) {
            videoWrapper.innerHTML = `<p class="video-message">${msg}</p>`;
        }

        function showVideoStream(url) {
            videoWrapper.innerHTML = `
                <img src="${url}" 
                    alt="Live Stream"
                    style="width: 100%; border-radius: 12px; max-height: 400px; object-fit: contain;"
                    onerror="this.onerror=null; this.src=''; this.parentElement.innerHTML='<p class=video-message>Stream not responding</p>';" />
            `;
        }

        const cartQuery = query(collection(db, "carts"), where("active", "==", true));
        onSnapshot(cartQuery, (snapshot) => {
            grid.innerHTML = ''; // clear previous

            if (snapshot.empty) {
                showVideoMessage("No active carts available");
                return;
            }

            showVideoMessage("Select a cart to view live video");

            snapshot.forEach((doc, index) => {
                const data = doc.data();
                const id = doc.id;
                const ip = data.ip_stream_url;

                const div = document.createElement('div');
                div.className = 'cart-card';
                div.innerHTML = `
                    <input type="radio" name="cart-select" id="cart-${index}" value="${ip}">
                    <label for="cart-${index}">${id}</label>
                `;
                grid.appendChild(div);
            });

            const radios = document.getElementsByName('cart-select');
            radios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const streamURL = radio.value;
                    showVideoStream(streamURL); // replaces default .src approach
                });
            });
        });

        //Low Inventory alerts
        const lowInventoryBar = document.getElementById("low-inventory-bar");

        async function loadLowInventoryItems() {
            const productsRef = collection(db, "products");
            const q = query(productsRef, orderBy("quantity", "asc"), limit(5));
            const querySnapshot = await getDocs(q);

            querySnapshot.forEach((doc) => {
                const product = doc.data();
                const badge = document.createElement("div");
                badge.className = "inventory-item-badge";
                badge.innerText = `${product.name} - ${product.quantity} left`;
                lowInventoryBar.appendChild(badge);
            });
        }

        loadLowInventoryItems();

        // Full Inventory Table Loader
        async function loadCompleteInventory() {
            const table = document.getElementById("complete-inventory-table");

            // Remove any previously appended rows (except the header row)
            while (table.children.length > 1) {
                table.removeChild(table.lastChild);
            }

            const productsRef = collection(db, "products");
            const q = query(productsRef, orderBy("quantity", "asc"));
            const snapshot = await getDocs(q);

            snapshot.forEach((doc) => {
                const p = doc.data();

                // Determine alert tag class and label
                let alertClass = "", alertLabel = "";
                if (p.quantity < 10) {
                    alertClass = "high-risk";
                    alertLabel = "Critical Stock";
                } else if (p.quantity >= 10 && p.quantity < 20) {
                    alertClass = "medium-risk";
                    alertLabel = "Limited Stock";
                } else {
                    alertClass = "low-risk";
                    alertLabel = "Stock Sufficient";
                }

                // Build the table row
                const row = document.createElement("div");
                row.className = "table-row";

                row.innerHTML = `
                    <div class="table-cell">${p.name}</div>
                    <div class="table-cell">${p.quantity}</div>
                    <div class="table-cell">â‚¹${p.price}</div>
                    <div class="table-cell">
                        <span class="alert-tag ${alertClass}">${alertLabel}</span>
                    </div>
                `;

                table.appendChild(row);
            });
        }
        loadCompleteInventory();


    });
    </script>

</body>
</html>